Adapted from:
http://www.codeproject.com/KB/recipes/CalcEngine.aspx